<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weekly Coding Challenge #1: Sign in/up Form</title>
    <link rel="stylesheet" href="senor.css" />
  </head>

  <body>
    <h2>Weekly Coding Challenge #1: Sign in/up Form</h2>
    <div id="root"></div>

    <!-- Dependencies -->
    <script
      crossorigin
      src="https://unpkg.com/react@17.0.2/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@17.0.2/umd/react-dom.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"
    ></script>

    <!-- Register Component -->
    <script type="text/babel">
      const { useState } = React;
      const { auth } = firebase;
      const { createUserWithEmailAndPassword, sendEmailVerification, GoogleAuthProvider, signInWithPopup } = auth;


function Register() {
    const [email, setEmail] = useState("");
    const [password, setPassword] = useState("");
    const [confirmPassword, setConfirmPassword] = useState("");
    const [error, setError] = useState("");
    const navigate = useNavigate();
    const { setTimeActive } = useAuthValue();
  
    const validatePassword = () => {
      let isValid = true;
      if (password !== "" && confirmPassword !== "") {
        if (password !== confirmPassword) {
          isValid = false;
          setError("Passwords do not match");
        }
      }
      return isValid;
    };
  
    const register = (e) => {
      e.preventDefault();
      setError("");
      if (validatePassword()) {
        createUserWithEmailAndPassword(auth, email, password)
          .then(() => {
            sendEmailVerification(auth.currentUser)
              .then(() => {
                setTimeActive(true);
                navigate("/verify-email");
              })
              .catch((err) => alert(err.message));
          })
          .catch((err) => setError(err.message));
      }
      setEmail("");
      setPassword("");
      setConfirmPassword("");
    };
  
    const signInWithGoogle = () => {
      const provider = new GoogleAuthProvider();
      signInWithPopup(auth, provider)
        .then((result) => {
          console.log(result.user);
        })
        .catch((error) => {
          console.log(error.message);
        });
    };
  
    return (
      <div>
        <form onSubmit={register}>
          <div>
            <label htmlFor="email">Email</label>
            <input
              type="email"
              id="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
            />
          </div>
          <div>
            <label htmlFor="password">Password</label>
            <input
              type="password"
              id="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
            />
          </div>
          <div>
            <label htmlFor="confirmPassword">Confirm Password</label>
            <input
              type="password"
              id="confirmPassword"
              value={confirmPassword}
              onChange={(e) => setConfirmPassword(e.target.value)}
              required
            />
          </div>
          <button type="submit">Register</button>
          {error && <div>{error}</div>}
        </form>
        <button onClick={signInWithGoogle}>Sign In with Google</button>
      </div>
    );
  }
  
  function App() {
    return (
      <AuthProvider>
        <Router>
          <Switch>
            <Route path="/" component={Register} />
            <Route path="/verify-email" component={VerifyEmail} />
          </Switch>
        </Router>
      </AuthProvider>
    );
  }
  
  ReactDOM.render(<App />, document.getElementById("root"));